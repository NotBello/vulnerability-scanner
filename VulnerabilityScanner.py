#!/usr/bin/python

# Created By Venujan Malaiyandi AKA Bello
# This program takes the banner from the target ports and compares it with a file

# Import Libraries
from socket import *
import os
import sys

# This function creates a socket which then connects with the specifiied port and ip
# Input params - Ip address of the target, Port of the target
def getBanner(IP, port):
	try:
		setdefaulttimeout(2)
		sk = socket()
		sk.connect((IP,port))
		banner = sk.recv(1024)
		sk.close()
		return banner 
	except:
		return

# This function opens the file to compare the extracted banner
# Input params- Returned banner, file name
def checkBanner(banner, filename):
	f = open(filename, 'r')
	for line in f.readlines():
		if line.strip("\n") in banner:
			print '[+] Server is vulnerable : ' + banner.strip("\n")

# Main function of the vulnerablitiy scanner
def startMain():
	if len(sys.argv) == 2:
		filename = sys.argv[1]
		if not os.path.isfile(filename):
			print '[-] File Does not exist!'
			exit(0)
		
		if not os.access(filename, os.R_OK):
			print '[-] Access Denied!'
			exit(0)
	else:
		print '[*] Usage : ' + str(sys.argv[0]) + '<vulnerability list file>'
		exit(0)

	
	portList = [21,22,25,80,110,443,445]
	
	for x in range(160,165):
		# print 'test'
		ip = "192.168.8." + str(x)
		for port in portList:
			banner = getBanner(ip, port)
			if banner:
				banner_str = banner.decode('utf-8', 'ignore').strip()
				checkBanner(banner_str,filename)
				print '[+] ' + ip + "/" +str(port) + ":" + banner
				

startMain()
